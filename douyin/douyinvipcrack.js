/******************************************
 * @name 抖阴视频🚗
 * @channel https://t.me/yqc_123
 * @feedback https://t.me/yqc_777
 * @version 1.0.0
******************************************
1.本脚本仅用于技术学习，禁止非法使用。
2.不得将本脚本用于任何商业或违法用途，违者后果自负。
3.在中国大陆地区，严禁传播本脚本。
4.开发者不对脚本的滥用承担任何责任。
5.违规使用导致的后果由使用者自行承担。
6.如有违反相关法规，将立即删除本脚本。
7.使用者若违反声明规定，将自动视为放弃使用权。
8.本声明的最终解释权归开发者所有。
******************************************

脚本描述: 去除全局广告(需要清理浏览器缓存)、解锁视频(不完美解锁, 部分视频无法解锁)
下载地址: https://d.lg3cdx.net?code=K7J4PS&channel=share

******************************************
^https?:\/\/cc.(qsk0ui|n2p4fa|h6xgec).cc\/h5\/app\/api\/(config|user\/info|video\/info|tab\/module) url script-response-body https://github.com/yecrybaby/script/blob/main/douyin/douyinvipcrack.js

hostname = cc.qsk0ui.cc, cc.n2p4fa.cc, cc.h6xgec.cc
******************************************/

const $ = new Env('抖阴视频')
var _0xod9='jsjiami.com.v7';const _0x280b93=_0x3281;(function(_0xdf14e3,_0x359af0,_0x497052,_0x161dd3,_0x3a0863,_0x39d6b5,_0x9d9aac){return _0xdf14e3=_0xdf14e3>>0x7,_0x39d6b5='hs',_0x9d9aac='hs',function(_0x3fd468,_0x1654ff,_0x354c14,_0x53206a,_0x59aeec){const _0x39b3f8=_0x3281;_0x53206a='tfi',_0x39d6b5=_0x53206a+_0x39d6b5,_0x59aeec='up',_0x9d9aac+=_0x59aeec,_0x39d6b5=_0x354c14(_0x39d6b5),_0x9d9aac=_0x354c14(_0x9d9aac),_0x354c14=0x0;const _0x455332=_0x3fd468();while(!![]&&--_0x161dd3+_0x1654ff){try{_0x53206a=-parseInt(_0x39b3f8(0xc5,'[vy6'))/0x1*(parseInt(_0x39b3f8(0xd7,'827o'))/0x2)+-parseInt(_0x39b3f8(0xf3,'tL!G'))/0x3*(-parseInt(_0x39b3f8(0xeb,'U#QC'))/0x4)+parseInt(_0x39b3f8(0xda,'Wo&I'))/0x5+-parseInt(_0x39b3f8(0xf2,'X0X0'))/0x6+-parseInt(_0x39b3f8(0xe4,'(IWn'))/0x7+-parseInt(_0x39b3f8(0xd0,'Wo&I'))/0x8*(-parseInt(_0x39b3f8(0xea,'Z$0h'))/0x9)+parseInt(_0x39b3f8(0xcd,'U#QC'))/0xa;}catch(_0x3e8eb6){_0x53206a=_0x354c14;}finally{_0x59aeec=_0x455332[_0x39d6b5]();if(_0xdf14e3<=_0x161dd3)_0x354c14?_0x3a0863?_0x53206a=_0x59aeec:_0x3a0863=_0x59aeec:_0x354c14=_0x59aeec;else{if(_0x354c14==_0x3a0863['replace'](/[efXQrytYuUbNWkMxHK=]/g,'')){if(_0x53206a===_0x1654ff){_0x455332['un'+_0x39d6b5](_0x59aeec);break;}_0x455332[_0x9d9aac](_0x59aeec);}}}}}(_0x497052,_0x359af0,function(_0x1539d5,_0x5b5948,_0x17f3dd,_0x3ecace,_0x2db421,_0x3e3063,_0x29dd38){return _0x5b5948='\x73\x70\x6c\x69\x74',_0x1539d5=arguments[0x0],_0x1539d5=_0x1539d5[_0x5b5948](''),_0x17f3dd='\x72\x65\x76\x65\x72\x73\x65',_0x1539d5=_0x1539d5[_0x17f3dd]('\x76'),_0x3ecace='\x6a\x6f\x69\x6e',(0x1618cc,_0x1539d5[_0x3ecace](''));});}(0x6600,0x53b14,_0x39f0,0xce),_0x39f0)&&(_0xod9=`\x91f`);const server='https://free.yuhengy17.me',NOTICE_KEY=_0x280b93(0xd3,'Kiwc')+$[_0x280b93(0xc2,'KHnW')]('yyyyMM')+_0x280b93(0xbc,'U#QC');function _0x3281(_0x1c07e7,_0xcdcd68){const _0x39f045=_0x39f0();return _0x3281=function(_0x32818a,_0x4a0c69){_0x32818a=_0x32818a-0xb7;let _0x3237c6=_0x39f045[_0x32818a];if(_0x3281['WmMcWT']===undefined){var _0x16e706=function(_0x5178f2){const _0x13f73e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1e2ff3='',_0x3f19c3='';for(let _0x49fad4=0x0,_0x2fc15a,_0x5bd4ec,_0x3a332d=0x0;_0x5bd4ec=_0x5178f2['charAt'](_0x3a332d++);~_0x5bd4ec&&(_0x2fc15a=_0x49fad4%0x4?_0x2fc15a*0x40+_0x5bd4ec:_0x5bd4ec,_0x49fad4++%0x4)?_0x1e2ff3+=String['fromCharCode'](0xff&_0x2fc15a>>(-0x2*_0x49fad4&0x6)):0x0){_0x5bd4ec=_0x13f73e['indexOf'](_0x5bd4ec);}for(let _0x16a5d2=0x0,_0x102747=_0x1e2ff3['length'];_0x16a5d2<_0x102747;_0x16a5d2++){_0x3f19c3+='%'+('00'+_0x1e2ff3['charCodeAt'](_0x16a5d2)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3f19c3);};const _0x364046=function(_0x3b5174,_0x2a90ac){let _0x339b71=[],_0x2a9ed3=0x0,_0xaf0a28,_0x22178a='';_0x3b5174=_0x16e706(_0x3b5174);let _0x2e4dcd;for(_0x2e4dcd=0x0;_0x2e4dcd<0x100;_0x2e4dcd++){_0x339b71[_0x2e4dcd]=_0x2e4dcd;}for(_0x2e4dcd=0x0;_0x2e4dcd<0x100;_0x2e4dcd++){_0x2a9ed3=(_0x2a9ed3+_0x339b71[_0x2e4dcd]+_0x2a90ac['charCodeAt'](_0x2e4dcd%_0x2a90ac['length']))%0x100,_0xaf0a28=_0x339b71[_0x2e4dcd],_0x339b71[_0x2e4dcd]=_0x339b71[_0x2a9ed3],_0x339b71[_0x2a9ed3]=_0xaf0a28;}_0x2e4dcd=0x0,_0x2a9ed3=0x0;for(let _0x3cc4b7=0x0;_0x3cc4b7<_0x3b5174['length'];_0x3cc4b7++){_0x2e4dcd=(_0x2e4dcd+0x1)%0x100,_0x2a9ed3=(_0x2a9ed3+_0x339b71[_0x2e4dcd])%0x100,_0xaf0a28=_0x339b71[_0x2e4dcd],_0x339b71[_0x2e4dcd]=_0x339b71[_0x2a9ed3],_0x339b71[_0x2a9ed3]=_0xaf0a28,_0x22178a+=String['fromCharCode'](_0x3b5174['charCodeAt'](_0x3cc4b7)^_0x339b71[(_0x339b71[_0x2e4dcd]+_0x339b71[_0x2a9ed3])%0x100]);}return _0x22178a;};_0x3281['ozTrvp']=_0x364046,_0x1c07e7=arguments,_0x3281['WmMcWT']=!![];}const _0x31503f=_0x39f045[0x0],_0x598b17=_0x32818a+_0x31503f,_0x30763d=_0x1c07e7[_0x598b17];return!_0x30763d?(_0x3281['rSveXj']===undefined&&(_0x3281['rSveXj']=!![]),_0x3237c6=_0x3281['ozTrvp'](_0x3237c6,_0x4a0c69),_0x1c07e7[_0x598b17]=_0x3237c6):_0x3237c6=_0x30763d,_0x3237c6;},_0x3281(_0x1c07e7,_0xcdcd68);}((async()=>{const _0x26d135=_0x280b93,_0x15c870={'KovDq':function(_0xd0f072,_0x7a7316){return _0xd0f072==_0x7a7316;},'rQnCG':_0x26d135(0xef,'0HaG'),'GUjZs':function(_0x4cdcc5){return _0x4cdcc5();},'abVWi':_0x26d135(0xe2,'dxkk')};_0x15c870[_0x26d135(0xed,'3phm')]($['getdata'](NOTICE_KEY),'true')?$[_0x26d135(0xe5,'KVlz')](_0x26d135(0xc9,'O!(F')):$['msg']($['name'],_0x15c870['rQnCG'],await _0x15c870[_0x26d135(0xdc,'r@jV')](getNotceAndSetCache));if(/<html/[_0x26d135(0xe1,'%(3#')]($response[_0x26d135(0xb8,'[vy6')])){const _0x107327=$response[_0x26d135(0xcf,'dxkk')][_0x26d135(0xca,'X0X0')](/<head >/,'<head><style\x20type=\x22text/css\x22>.dialog,.startContent{display:none!important;}</style>\x20');$[_0x26d135(0xc8,'SK5]')]({'body':_0x107327});return;}else $[_0x26d135(0xdb,'VD7J')][_0x26d135(0xc6,'tG@J')]({'url':server+_0x26d135(0xd8,'m4*W'),'headers':{'Content-Type':_0x15c870[_0x26d135(0xe0,'Z$0h')],'id':_0x26d135(0xbe,'tL!G')},'body':JSON['stringify']({'url':$request[_0x26d135(0xb9,'3phm')],'yh':$response['body']})})['then'](({body:_0x3fc1b7})=>$[_0x26d135(0xf1,'aghv')]({'body':_0x3fc1b7}))['catch'](_0x8d6db=>$[_0x26d135(0xbd,'1[Rw')](_0x26d135(0xe7,'5D*S')+_0x8d6db,_0x26d135(0xd4,'3Z[2'),_0x26d135(0xc0,'oxyb')))[_0x26d135(0xe9,'TQtK')](()=>$[_0x26d135(0xb7,'1[Rw')]({}));})());function _0x39f0(){const _0x476860=(function(){return[_0xod9,'XQxMjtusyXjkiyUarxmbyifMN.HcNroKMemWY.v7==','cSoMW7tdSW','ASk5WO3cNJ5Gq2ZdMCk1vx3cMMLcWQa','BCk8WQlcQ8ooW4VdKW','l8kCE8oLW6VcJJ1dW5RdN8kJeG','W4hdLsS','sL/dUSkHxCo5W6Tr','6ksZ6zwF5Awl6lAKACkc','WPXlrsi','cHFcKeCbjKK','W60/W548ECk5zL4D','WPpdRmkKW6GOWPWaW5JcVCk2WPxdKq','WPXqxsi','yCoSb8ohtW','xNXQ','6iAj5P+r5AoZ5PUB','W4NdLtKLWRu','emoHBCor','cWNcUSoDcSkUWQLyWQOQFcJcPq','WObda8klW7mmmG','5PYH6iwu5PYD5lUN55E55lQB5OQ/5P2/5A+k5lQ577+e56wm5QYm6zYT5RoH5l2d55As44kI','5lUa5B6G5Bof5P+W6is25P2o55w/5lI15lIY5lYz5zAM5lIR5OQs6lYd5Rod55Ep6ygH77+k6l636igB5zcE5P6Z6isI6lsC44kH'].concat((function(){return['r8okW61LW7K','k8oQW6hdUmkFWOZcGHJdVmk5WPFdHCkE','W41dWPJcVG','DCkRt8kw','x8oXhq','amkDWRy8WQS','y8k9WONcGIq5dtFdK8k+vxZcMMLjWQVcTCk2hZddRSkpvttdHmktFSkDmLX4WR3cHCkZWOCqBMldRmovWOrXqh3dTMhdOLOTWPbMW7zsWR8PW5ydWPrxW63cIsTc','W7tcTmo4WQP5W44ZW7dcMW','W4XEWOtcTmoI','W5jihCk0W50P','W5RdOrCecXFcH8k6WR0YWRBdHq','8lgdOdVcQrlcPmkNn8kgirhcU0qaoxpdG8oYWORdSCklW73cP0Xl8y+WUq','W7G/WQFdJK4','yX0FW44','5z6f5lQx5zQX5Aw76zQS5z+m5yYf77+F5lQP56AI5l6E5PoR5P+46iAG5P+d44k8','WO3cRaS','imo2e8ozW69NWRldQdDbnq','W4GzW78B','6i6T5y+l6l2K56MP55wI5zk35As36lAZW6NcT+s+UUExU+AFO+wFOUwJToAAGa','FNldLGC','5P2S5PYD5BsD6ycd55Ye6l6i77+e5P+j5Q6U5lIW5yA56ykV55+V','s1/dVSkau8o0W7O','W40EW6vOWP0'].concat((function(){return['5AAj5P+a6lYG5yY/55QV5ywW5Ro36kEC77685BoC56UW5yYH5yUq6zM+5PYb6iEu5P+144oD','WP7dQCkGW6KGWPTQW7NcRCkmWRtdRCo2','5lYW55AB6ig86iIE6lYQ5yYC5AgP5PU86kAz5AYe77+p5BgR6iwr5yUe6ksD5lM85PwF5B2r5l+i55EC5P2M44c4','ACkMWPNcIW','WPnvWPuJW4SvW4ehlmkDW45h','6lYK6kwY5l2655Ah5A6y6iAp55Il5zgB5P6p55sr5l+P55Af6ior6iAQ6kkA5OQq5OUI44g9','sCkwW7BcQWP0W6iaW7VdV8kVW4O','WP3dMxddLJS','5yEE5RcW6Agx6you6i2t5y+d5PYT5PAD6is05P+m','W5FdJgJcKcu','W7OfW7VdQHuohSoSWPejWQS','WOddJ8oMW6imW67dVmoj','W6jwWRpcTqmrmSojWQaPWPmjWQVcRhpcKaFcRX47','aYTpW7ZdO2KCoG','WPzFWPaNW4PiW7KgemkQW6q','ztPfuG','DuzNW5tdPG','W7JcKSkIW7FcSNnCW7lcTfddUa','W5XiaCkJ','W5NcG2GuWOfJhmo+xG','WR1SWR8rCq'];}()));}()));}());_0x39f0=function(){return _0x476860;};return _0x39f0();};async function getNotceAndSetCache(){const _0x4a98b0=_0x280b93,_0x204c6b={'nesQC':_0x4a98b0(0xf4,'VD7J'),'MOMbY':_0x4a98b0(0xd1,'Kiwc'),'oDBII':_0x4a98b0(0xcc,'dxkk'),'lsGyb':'本声明的最终解释权归开发者所有。','XOQcb':_0x4a98b0(0xe8,'FMAj'),'LiqdW':'yyyyMM'};let _0x42ae1e=[_0x204c6b[_0x4a98b0(0xd5,'oxyb')],_0x4a98b0(0xf5,'m4*W'),_0x4a98b0(0xc3,'KVlz'),'开发者不对脚本的滥用承担任何责任。',_0x204c6b['MOMbY'],_0x204c6b['oDBII'],_0x4a98b0(0xce,'QED!'),_0x204c6b[_0x4a98b0(0xcb,'Wo&I')]];const _0x381851=_0x4a98b0(0xbb,'dxkk');try{const {body:_0xa26503}=await $['http'][_0x4a98b0(0xc4,'qYOh')](_0x381851);_0x42ae1e=$[_0x4a98b0(0xc1,'DnEW')](_0xa26503),$[_0x4a98b0(0xee,'r@jV')]('获取远程生命成功');}catch(_0x2011b2){$['log'](_0x4a98b0(0xc7,'SK5]'));}$['setdata'](_0x204c6b[_0x4a98b0(0xf6,'krXF')],NOTICE_KEY);const _0x3dede1=$[_0x4a98b0(0xec,'FMAj')](_0x204c6b[_0x4a98b0(0xba,'&NXp')],new Date(new Date()[_0x4a98b0(0xe6,'X0X0')](new Date()['getMonth']()-0x1)));return $[_0x4a98b0(0xe3,'!el^')](null,_0x4a98b0(0xf0,'KVlz')+_0x3dede1+'_notified'),_0x42ae1e[_0x4a98b0(0xde,'tL!G')]('\x0a');}var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,r)=>{s.call(this,t,(t,s,i)=>{t?r(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.logLevels={debug:0,info:1,warn:2,error:3},this.logLevel="info",this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null,...s){try{return JSON.stringify(t,...s)}catch{return e}}getjson(t,e){let s=e;const r=this.getdata(t);if(r)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,r)=>e(r))})}runScript(t,e){return new Promise(s=>{let r=this.getdata("@chavy_boxjs_userCfgs.httpapi");r=r?r.replace(/\n/g,"").trim():r;let i=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");i=i?1*i:20,i=e&&e.timeout?e.timeout:i;const[o,a]=r.split("@"),n={url:`http://${a}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:i},headers:{"X-Key":o,Accept:"*/*"},timeout:i};this.post(n,(t,e,r)=>s(r))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),r=!s&&this.fs.existsSync(e);if(!s&&!r)return{};{const r=s?t:e;try{return JSON.parse(this.fs.readFileSync(r))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),r=!s&&this.fs.existsSync(e),i=JSON.stringify(this.data);s?this.fs.writeFileSync(t,i):r?this.fs.writeFileSync(e,i):this.fs.writeFileSync(t,i)}}lodash_get(t,e,s){const r=e.replace(/\[(\d+)\]/g,".$1").split(".");let i=t;for(const t of r)if(i=Object(i)[t],void 0===i)return s;return i}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,r)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[r+1])>>0==+e[r+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,r]=/^@(.*?)\.(.*?)$/.exec(t),i=s?this.getval(s):"";if(i)try{const t=JSON.parse(i);e=t?this.lodash_get(t,r,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,r,i]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(r),a=r?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(a);this.lodash_set(e,i,t),s=this.setval(JSON.stringify(e),r)}catch(e){const o={};this.lodash_set(o,i,t),s=this.setval(JSON.stringify(o),r)}}else s=this.setval(t,e);return s}getval(t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(t);case"Quantumult X":return $prefs.valueForKey(t);case"Node.js":return this.data=this.loaddata(),this.data[t];default:return this.data&&this.data[t]||null}}setval(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(t,e);case"Quantumult X":return $prefs.setValueForKey(t,e);case"Node.js":return this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0;default:return this.data&&this.data[e]||null}}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){switch(t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"],delete t.headers["content-type"],delete t.headers["content-length"]),t.params&&(t.url+="?"+this.queryStr(t.params)),void 0===t.followRedirect||t.followRedirect||((this.isSurge()||this.isLoon())&&(t["auto-redirect"]=!1),this.isQuanX()&&(t.opts?t.opts.redirection=!1:t.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,r)=>{!t&&s&&(s.body=r,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,r)});break;case"Quantumult X":this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:r,headers:i,body:o,bodyBytes:a}=t;e(null,{status:s,statusCode:r,headers:i,body:o,bodyBytes:a},o,a)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:r,statusCode:i,headers:o,rawBody:a}=t,n=s.decode(a,this.encoding);e(null,{status:r,statusCode:i,headers:o,rawBody:a,body:n},n)},t=>{const{message:r,response:i}=t;e(r,i,i&&s.decode(i.rawBody,this.encoding))})}}post(t,e=(()=>{})){const s=t.method?t.method.toLocaleLowerCase():"post";switch(t.body&&t.headers&&!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["content-type"]="application/x-www-form-urlencoded"),t.headers&&(delete t.headers["Content-Length"],delete t.headers["content-length"]),void 0===t.followRedirect||t.followRedirect||((this.isSurge()||this.isLoon())&&(t["auto-redirect"]=!1),this.isQuanX()&&(t.opts?t.opts.redirection=!1:t.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](t,(t,s,r)=>{!t&&s&&(s.body=r,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,r)});break;case"Quantumult X":t.method=s,this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:r,headers:i,body:o,bodyBytes:a}=t;e(null,{status:s,statusCode:r,headers:i,body:o,bodyBytes:a},o,a)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let r=require("iconv-lite");this.initGotEnv(t);const{url:i,...o}=t;this.got[s](i,o).then(t=>{const{statusCode:s,statusCode:i,headers:o,rawBody:a}=t,n=r.decode(a,this.encoding);e(null,{status:s,statusCode:i,headers:o,rawBody:a,body:n},n)},t=>{const{message:s,response:i}=t;e(s,i,i&&r.decode(i.rawBody,this.encoding))})}}time(t,e=null){const s=e?new Date(e):new Date;let r={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in r)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[e]:("00"+r[e]).substr((""+r[e]).length)));return t}queryStr(t){let e="";for(const s in t){let r=t[s];null!=r&&""!==r&&("object"==typeof r&&(r=JSON.stringify(r)),e+=`${s}=${r}&`)}return e=e.substring(0,e.length-1),e}msg(e=t,s="",r="",i){const o=t=>{switch(typeof t){case void 0:return t;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:t};case"Loon":case"Shadowrocket":return t;case"Quantumult X":return{"open-url":t};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{let e=t.url||t.openUrl||t["open-url"];return{url:e}}case"Loon":{let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}case"Quantumult X":{let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl,r=t["update-pasteboard"]||t.updatePasteboard;return{"open-url":e,"media-url":s,"update-pasteboard":r}}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,s,r,o(i));break;case"Quantumult X":$notify(e,s,r,o(i));break;case"Node.js":}if(!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),r&&t.push(r),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}debug(...t){this.logLevels[this.logLevel]<=this.logLevels.debug&&this.log("[DEBUG]",...t)}info(...t){this.logLevels[this.logLevel]<=this.logLevels.info&&this.log("[INFO]",...t)}warn(...t){this.logLevels[this.logLevel]<=this.logLevels.warn&&this.log("[WARN]",...t)}error(...t){this.logLevels[this.logLevel]<=this.logLevels.error&&this.log("[ERROR]",...t)}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️${this.name}, 错误!`,e,t);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,e,void 0!==t.message?t.message:t,t.stack)}}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;switch(this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(t);break;case"Node.js":process.exit(1)}}}(t,e)}
